<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CustomAssets: Askowl-CustomAssets.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Askowl-100x100.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CustomAssets
   </div>
   <div id="projectbrief">Askowl Custom Assets</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_askowl-_custom_assets_8md.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Askowl-CustomAssets.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# [Custom Assets](http://www.askowl.net/unity-custom-assets)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;* Table of Contents</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{:toc}</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&gt; The Doxygen pages are [here](https://paulmarrington.github.io/Unity-Documentation/CustomAssets/Doxygen/html/annotated.html)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;## Executive Summary</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;Custom assets are all about decoupling. They are project resources that contain data and code wrapped in a Unity ScriptableObject. They provide emitters to signal change and persistence between sessions. Read the list of benefits [here](#benefits) and watch the video introduction [here](https://www.youtube.com/watch?v=).</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;I have chosen to use this executive summary to provide examples of how you can use custom assets.</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;### Decoupling Components</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;After you create a custom asset in the project, any reference in components is to the same object. Our example is the ubiquitous player health - a value between zero and one that needs to be accessed by components to:</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;* display a health bar on the screen</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;* show health percentages on a status page</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;* trigger death animation on reaching zero</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;* be reduced by damage (hit, poison, fall)</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;* be increased by time, potions, med-kits.</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;* be reviewed by other actions (such as no jumping on low health)</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;* In this example a CustomAsset.Float project resource does the job while markedly reducing the amount of code and support compared to a singleton.</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;See how easy it is to create [here](#health-bar) e in [this](https://www.youtube.com/watch?v=) short video including testing framework. Use the same techniques for stamina, mana, progress and the many other measures used in games. Then branch out to more uses.</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;### Game Managers</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;The traditional approach of using a MonoBehaviour as a manager creates a system that is difficult to test in isolation. [Here](https://www.youtube.com/watch?v=) we have a video on creating the framework for a health manager using custom assets. Go [here](#health-manager) if you prefer to read.</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;Refactoring existing code into custom asset managers can be done in very little time while providing benefits in stability, flexibility and testing. [Here](#refactoring-to-use-custom-assets) is a non-trivial example from existing code.</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;### Persistent Storage</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;Every mutable custom asset includes a checkbox in the inspector for persistent storage. Data saves when changed and restored on program restart.</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;&gt; Read the code in the Examples Folder and run the Example scene</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;## Videos</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;* A Health System Example</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  1. [The Health Bar](https://youtu.be/7P6fc-AQfnk)</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  2. [The Health Manager](https://youtu.be/pgzjMbyY7tc)</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;* [Converting a Game Manager to Custom Assets](https://youtu.be/juJ-R53hlaE)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;## Cheat Sheet</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;* ***Manager***: Basic custom asset. Loaded in Managers game object or with Manager.Load for testing</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;### Mutable Custom Assets</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;Entries can be changed and listeners can register to react to the change.</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;* ***AudioClips*** - AudioClipSet where list of clips can be modified</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;* ***Boolean***</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;* ***ChangeOverTime*** - Given a Float custom asset, change it&#39;s slowly</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;* ***Field*** - Static helper class for setting fields in a compound custom assets</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;* ***Float***</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;* ***GameObject*** - Use with connector to access a game object from a custom asset</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;* ***Integer***</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;* ***OfType*** - Base mutable providing emitter and persistence activities</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;* ***String***</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;* ***StringSet*** - List of strings with picker</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;* ***Trigger*** - Fired on command instead of on change</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;###  Constant Custom Assets</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;* ***AudioClips*** - Pick from AudioClipSet</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;* ***AudioClipSet*** - Picker for clip, volume, pitch and distance</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;* ***Base*** - Base class for all custom assets</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;* ***Boolean***</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;* ***Enumeration*** - Subclass to define set</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;* ***Float***</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;* ***Integer***</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;* ***OfType*** - Base class for all constant custom assets</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;* ***Quotes*** - Pick a quote from a QuoteSet</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;* ***QuoteSet*** - Quotes container loaded from text assets</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;* ***String***</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;* ***StringSet*** - Set of strings when Enumeration is too heavy duty</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;### Connectors</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;* ***Animator*** - Given the parameter name, trigger or set bool, int or float animation control.</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;* ***GameObject*** - give access to a game object from a custom asset</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;* ***RectTransform*** - access/update position and anchors</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;* ***Transform*** - access/update size and scale</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;### Drivers</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;* ***Boolean*** - for boolean unity events</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;* ***Driver*** - Register and deregister the listener with the channel</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;* ***Integer*** - for integer unity events</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;* ***NamedBoolean*** - driver for named events used in the animator</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;* ***NamedFloat*** - driver for named events used in the animator</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;* ***NamedInteger*** - driver for named events used in the animator</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;* ***NamedString*** - driver for named events used in the animator</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;* ***NamedTrigger*** - driver for named events used in the animator</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;* ***String*** - for string unity events</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;* ***Trigger*** - for action trigger unity events</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;## Introduction</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;Unity provides a base class called [ScriptableObject](https://docs.unity3d.com/ScriptReference/ScriptableObject.html). Derive from them to create objects or assets that don&#39;t need to be attached to game objects.</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;In short, a `ScriptableObject` is a class that contains serialisable data and functionality. Each instance of a class that derives from `ScriptableObject` has representation on disk as an asset. Each asset is a source for data and actions not coupled to a scene. The decoupling makes for functionality that is easy to test. It also provides modules to be shared across and between projects.</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;Custom assets are Unity scriptable objects on steroids. They provide the glue that allows you to piece together a better game.</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;1. Better than singletons</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  1. Share information across scenes, game objects and components; and</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  2. Seed it as a resource in the project; and</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  3. Have it made read-only, read/write and even persistent; and</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  4. Drive components directly without additional code; and</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  5. Add a description to each custom asset to clarify usage; and</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  5. Attach to existing components to provide dynamic action without code</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    1. Start and stop animations with a trigger, boolean, integer or float custom asset; or</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    2. Control canvas groups, image fill or text field content with float and string custom assets</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;2. Packaged with many useful standard custom assets</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  1. ***Boolean*** - where components can react to a change of state</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  2. ***Integer*** - that can be changed by code or visual slider</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  3. ***Float*** - components can react and/or display results on value change</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  4. ***String*** - for display or detailed action control</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  5. ***StringSet*** - provides a more powerful and flexible alternative to enums</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  6. ***Trigger*** - an emitter where components can attach as needed without additional code</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  7. ***Polling*** - to provide custom asset triggers for external data changes</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  9. ***AudioClips*** - allowing random selection from a set of audio clips with variations in volume, pitch and distance to provide a better audio experience for your players</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  10. ***Quotes*** - Load and retrieve text from within the component or other text resource files either randomly or in sequence. Good for quotes, jokes, game hints or news feeds.</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;3. Create your custom assets with any serialisable data and optional supporting scripts</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;4. Every custom asset has a dictionary of members to save more than one copy of data - accessed by name.</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;### Custom Assets - the new Singleton</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;Static variables are not evil, just inflexible. Singleton MonoBehaviour instances are not corrupt either. However, both encourage tight coupling between interested parties.</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;So now for a bit of mild blasphemy. Assets created from scriptable objects, and hence custom assets are Unity supported *singletons*. Create `[SerializeField]` fields and drag an asset of the correct type onto them in the editor. All reference to the same in-memory instance.</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;Using custom assets over traditional singletons provide some benefits:</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;* Code is less coupled - or is that more decoupled?</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;* Custom assets can be tested in isolation.</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;* Alternative custom assets can be injected into objects that are expecting them. An inventory may depend on location or whether the player is in training mode.</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;* It is less error prone to pass custom assets between scenes and projects.</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;* Functionality can be more generalised for direct reuse from within the editor without writing as much scaffolding code. A `Float` custom asset, for example, can have components that hook into display objects. Sliders and scroll-bars can also update it without additional code by adding it to the *On Value Changed* field.</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;* A custom asset as a singleton to hold game data has one massive failing. There is one copy only. If you want to store player health for an unknown number of players, how do we save it? For this, custom assets have the concept of members. Each named entry holds a reference to the custom asset storage that can be accessed by member name.</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;### Custom Assets as Game Managers</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;Managers are a favourite Unity pattern. As well as a system-wide master manager, many games have them for player, enemies, sound and more. They have some standard features:</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;* They are accessed by a static `Instance` variable.</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;* They are a MonoBehaviour that sets `Instance` in `Awake()`.</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;* They call `DontDestroyOnLoad(gameObject)` if they are to be common across scenes.</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;* There is often one manager to rule them all.</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;It is not uncommon to see code like:</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;```c#</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;health = GameManager.Instance.PlayerManager.MaxHealth;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;```</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;Try testing that component in isolation.</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;By contrast, a custom asset approach would be more like:</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;```c#</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;[SerializeField] maxHealth;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;...</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;health = maxHealth;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;```</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;Manager custom assets are the most useful when decoupled. They deal with data custom assets by making changes and responding to events. This manager can be tested in isolation without loading the complete game. Test in concert with the HealthManager and the HitManager for more complex scenarios.</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;``` c#</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  [CreateAssetMenu(menuName = &quot;Managers/Armor&quot;), Serializable]</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  public class ArmorManager : Manager {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    [SerializeField] private Float armorStrength = default;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    [SerializeField] private Float hitAmount = default;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    [SerializeField] private Float health = default;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    [SerializeField] private Float armorDegradation = default;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    protected override void Initialise() =&gt; hitAmount.Emitter.Subscribe(OnHit);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    private void OnHit() {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      // the stronger the armor the less a hit will do damage</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      var adjustedHit = hitAmount * (1.0f - armorStrength);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      health.value -= adjustedHit;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      // But eac hit damages the armor a little</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      armorStrength -= hitAmount * armorDegradation;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;```</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;#### Manager Loading</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;Player managers should be logic. Data have their custom assets. Since managers only react to events, they need to be explicitly loaded. In the Unity editor select the menu ***GameObject // Create Managers***. Drag the managers into the list in the newly created MonoBehaviour.</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;![Manager Custom Asset Container](Managers.png)</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;For testing, we don&#39;t need a scene â€” another benefit of decoupling. `Manager` provides a `Load` method for independent testing. The asset can be found by name with or without a path. Only as much of the path as needed for uniqueness needs be given.</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;``` c#</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  public class HealthManagerTest : PlayModeTests {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    [UnityTest, Timeout(100000)] public IEnumerator HealthManager() {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      //- Our health component will take 1,000 seconds to go from zero to full. Let&#39;s speed things up by 10x</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      Time.timeScale = 10;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      try {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        //- We don&#39;t need a specific scene, just load the custom assets</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        Manager.Load&lt;HealthManagerTranscript&gt;(&quot;HealthManager.asset&quot;);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        var health = Manager.Load&lt;Float&gt;(&quot;Health.asset&quot;);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        health.Set(0);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        //- Timeout attribute will cause a test failure after 10 seconds</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        while (true) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;          //- This causes a 1/10th of a second delay due to the modified scale</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;          yield return new WaitForSeconds(1.0f);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;          //- Leaving once the test passes is a successful result. This should take 1 second at the current time scale.</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;          if (health &gt;= 0.01f) yield break;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      } finally {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        Time.timeScale = 1;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    }</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;```</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;### Custom Assets as Configuration</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;The most common use for scriptable objects is to ignore the scriptable part and use them as configuration containers. A Custom Asset is a file within the project. This file contains a reference to the script and serialised copies of all the data as added in the Unity editor.</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;You can safeguard the serialisable data by making it a private `[SerializeField]` and using accessors to allow reading. Alternatively, you can use them as seed data and change them during program execution.</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;```c#</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;class MyData : CustomAsset {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;[SerializeField] private int maxHealth;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;[SerializeField] private float timeOfDay;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;// maxHealth cannot be changed outside this class</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;public int MaxHealth { get { return maxHealth; } };</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;// timeOfDay can be updated</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;public float TimeOfDay { get { return timeOfDay; } set { timeOfDay = value; } };</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;```</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;Later I will introduce better and more granular ways to handle data.</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;### Read-only Custom Assets</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;The custom asset inspector allows a designer to mark the asset read-only For serialisable classes as values, protection of internal data is still code bases. Make the fields private and serialisable so that the editor can change them. Then use accessors without `set` to only allow for reading. If you can&#39;t trust the code accessing data in a complex object graph, either clone the custom asset or lock down access at all levels.</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;```c#</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;var clone = Object.Instantiate(myCustomAsset).Value;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;```</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;Cloning is much more expensive at runtime than baking in protection during the compile phase.</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;### Custom Assets and Persistence</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;Custom Assets adds optional persistence to scriptable objects. Persistent assets must be read/write and have the `persistent` field set in the Unity Editor.</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;Each persistent object is serialised to JSON and written as a `PlayerPref` entity. For this reason, the total storage is about one megabyte. For more massive storage needs, use a database.</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;The key is made up of the name of the asset and the class name, making it unique to the application.</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;Set persistence from the Unity inspector or code.</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;```c#</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;myAsset.Persistence = true;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;```</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;## Benefits</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;* Allows complete decoupling of components and groups of components, data from logic and logic from the rest of the Unity framework. It provides for a modular system that is more stable, easier to maintain and infinitely more testable.</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;* Using custom assets as data containers allow for all vital information to be editable in the Unity inspector, both for game creation and Editor run-mode testing.</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;* Problems can be isolated to integrity tests against one or more manager custom assets without having to run up a complete system.</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;* All custom assets provide an implementation of the observer pattern. Changes can trigger logic in managers which can trickle up to visual changes at the Unity level.</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;* Custom assets can be made to persist so that changes made in one session reload in the next session. The next release extends persistence to cloud storage.</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;* Connectors are game object components that allow you to drive other components directly from custom asset data. Currently, there are connectors for a GameObject instance directly, Animator, Transform and RectTransform components.</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;* Drivers are game object components that, given a data custom asset can call a public setter on other components on the game object. Many game objects provide public setters while others need a connector to be accessible.</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;## Accessing Custom Assets</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;A custom asset is like any other Unity asset. Create a field for it in a MonoBehaviour or other CustomAsset class and drop in the reference.</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;```c#</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;public sealed class CustomAssetsExample: MonoBehaviour {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  [SerializeField] private Float             maxFloat;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  [SerializeField] private Float             currentFloat;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  // ...</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;}</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;```</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;![sample custom asset for float](SampleCustomAsset.png)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;Custom assets aid decoupling. Many components can operate without directly knowing each other.</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;Access custom asset values by either casting or using the `Value` getter. ToString() will aways call ToString() on the Value field.</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;```c#</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;Debug.LogFormat(&quot;{0} == {1}&quot;,maxFloat.Value, ((float) maxFloat);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;Debug.LogFormat(&quot;{0} == {1}&quot;,maxFloat.Value.ToString(), maxFloat.ToString());</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;```</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;### Instance</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;There is a second way. As long as a custom asset is referenced as above at least once, it is available with code access elsewhere.</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;```c#</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;Float lifetime = Float.Instance(&quot;Lifetime&quot;);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;UniqueAsset = UniqueAsset.Instance(); // &quot;UniqueAsset&quot; name optional</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;```</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;The static Instance method is also useful for in-memory custom &quot;assets&quot;. The first call creates a copy while other calls retrieve a reference. You can even keep the value between invocations of the game by setting persistence.</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;```c#</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;lifetime.Persistence = true;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;```</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;## Creating Custom Assets</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;Custom Assets are ScriptableObjects serialised and written to disk as an asset in the project.</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;```YAML</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;%YAML 1.1</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;%TAG !u! tag:unity3d.com,2011:</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;--- !u!114 &amp; 11400000</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;MonoBehaviour:</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  m_ObjectHideFlags: 32</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  m_PrefabParentObject: {fileID: 0}</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  m_PrefabInternal: {fileID: 0}</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  m_GameObject: {fileID: 0}</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  m_Enabled: 1</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  m_EditorHideFlags: 0</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  m_Script: {fileID: 11500000, guid: 22f206729bb7e417e9b12649707e941e, type: 3}</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  m_Name: SampleFloatVariable</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  m_EditorClassIdentifier: </div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  Description: </div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  value: 0</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  readWrite: 1</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  persistent: 0</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;```</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;Each custom asset type has an entry on the ***Create / CustomAssets / asset name***. Use it, select the resulting file and fill in the fields. If you want to load it from disk using `Resources.Load(pathFromResources)` you will need to place it in a ***Resources*** folder.</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;### OfType{T}</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;`CustomAsset.OfType&lt;T&gt;` is the base type for all custom assets except `Trigger`. Functionality includes being able to register events on change, persistence and some read-only protection.</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;```c#</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;[CreateAssetMenu(menuName = &quot;Examples/LargerAssetSample&quot;)]</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;public class LargerAssetSample : CustomAsset.OfType&lt;LargerAssetContents&gt; { }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;[Serializable]</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  public class LargerAssetContents {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    public int    Order;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    public float  Limit;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    public string Name;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;```</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;All CustomAsset instances have a description field. Since you can use generic assets, it is useful to give others comments on what specific assets represent.</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;### Primitive Custom Assets</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;```c#</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  [SerializeField] private Float             currentFloat;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  [SerializeField] private Integer           integer;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  [SerializeField] private String            str;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  [SerializeField] private Boolean           boolean;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;```</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;Each if these custom assets can be in a project with or without supporting code. It is possible, for example, to have a `Float` value set in the ***On Value Changed*** field of a Slider or Scrollbar, then displayed using a driver like `CustomAsset.FloatDriver` to set the fill amount on a health bar Image component.</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;#### Float</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;The mutable `Float` custom asset also includes a range set in the inspector. Attempts to change the value outside the limits leave the value at the closest bound. It allows managers to increase or decrease a value without being concerned with going outside acceptable limits.</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;``` c#</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;health += 0.2f;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;// is clearer to read than</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;if (health &lt; 0.8) health += 0.2f;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;```</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;Set bounds with sliders or text entry. The latter is necessary if you need a value outside the range the sliders are set.</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;Conditions may require a range change. A tired warrior may not be able to have health over 80%. Use `Float.Minimum` and `Float.Maximum` to make the adjustments.</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;### Object (non-primitive) Custom Assets</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;A class will better represent a more complex custom asset. There are a few boundaries. The class must be serialisable and any members you want to change in the inspector labelled as serialised fields.</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;``` c#</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  [Serializable] public class LargerAssetContents {</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    public int I;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    public float F;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    public string S;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;```</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;Take care while setting fields. The static `CustomAsset.Mutable.Field` class provides helpers for float, double, int, long, bool, string, Vector2, Vector3, Vector4 and Quaternion types. There is also a generic form for adding new structs. You need to provide a comparator.</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;``` c#</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;Field.Set(largeAssetContents, ref largeAssetContents.F, 12);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    public static void Set(this WithEmitter asset, ref Vector4 field, Vector4 from) =&gt;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      asset.Set(ref field, from, (a, b) =&gt; a == b);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;```</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;### Enumeration</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;Rather than use the c# language element `enum`, consider using an `Enumeration` custom asset. Using the Decoupler service environment as an example, we create it by sub-classing `Enumeration`.</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;``` c#</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;[CreateAssetMenu(menuName = &quot;Decoupler/Environment&quot;)]</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;public class Environment : Enumeration { }</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;```</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;Now, use the menu to create as many environment elements as you need.</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;![Environments](Environments.png)</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;Create a serialisable field CustomAsset or MonoBehaviour that intends to use the enumeration.</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;``` c#</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;[Serializable] public class Context : Base {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  [SerializeField] private Environment environment = default;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  protected virtual bool Equals(Context other) =&gt;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    base.Equals(other) &amp;&amp; Equals(environment, other.environment);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  public override int GetHashCode() {</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    unchecked { return (base.GetHashCode() * 397) ^ (environment != null ? environment.GetHashCode() : 0); }</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;}</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;```</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;In this example, different services sub-class context and add additional fields. A common one is `platform`, allowing different service implementations for iOS, Android, Steam, and others.</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;During initialisation, the service manager decides which service are from the given current context.</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;``` c#</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;var useful = services.Where(service =&gt; service.context.Equals(context) &amp;&amp; service.IsExternalServiceAvailable());</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;```</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;### Trigger</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;A trigger is unusual in that it does not have any data apart from CustomAsset requirements. Triggers do not have persistence, so a subclass containing data cannot be saved.</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;### Members</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;A custom asset with any content data also can store and retrieve separate copies by name. For persistent custom assets, the member names and values saved to storage along with the main value.</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;```c#</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;[SerializeField] CustomAsset.Integer myInt;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;// ...</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;myInt.Value = 22;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;myInt[&quot;One&quot;] = 1;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;myInt[&quot;Two&quot;] = 2;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;string[] names = myInt.MemberNames;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;Assert.AreEqual(names.Length, 2);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;Assert.AreEqual(myInt[&quot;One&quot;], 1);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;Assert.AreEqual(myInt.ToStringForMember(&quot;One&quot;), &quot;1&quot;);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;Assert.True(myInt.Contains(&quot;One&quot;));</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;myInt.Remove(&quot;One&quot;);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;Assert.False(myInt.Contains(&quot;One&quot;));</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;Assert.True(myInt.Contains(&quot;Two&quot;));</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;myInt.Clear();</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;Assert.False(myInt.Contains(&quot;Two&quot;));</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;```</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;`ToStringForMember` requires special mention as it can be use in Inspector event receivers to set values directly.</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;### AudioClips</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;Playing one from a selection of audio clips have been a well-used proof of concept for `ScriptableObject`. Because custom assets, sets and some other toys from this package make the implementation even simpler, I am displaying the source here.</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;```c#</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  [CreateAssetMenu(menuName = &quot;Custom Assets/Sound Clips&quot;, fileName = &quot;Clips&quot;)]</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  public sealed class AudioClips : Set&lt;AudioClip&gt; {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    [SerializeField, Header(&quot;Audio&quot;)]     private Range volume   = new Range(1, 1);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    [SerializeField, RangeBounds(0, 2)]   private Range pitch    = new Range(1, 2);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    [SerializeField, RangeBounds(0, 999)] private Range distance = new Range(1, 999);</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    public void Play(AudioSource source) {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      source.clip        = Pick();</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      source.pitch       = pitch.Pick();</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      source.volume      = volume.Pick();</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      source.minDistance = distance.Min;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      source.maxDistance = distance.Max;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      source.Play();</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;```</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;`Range` class and `RangeBound` attribute are available in the custom assets package. `AudioClips` will work without them, but sliders are easier to use.</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;The actor, `Play`, requires an `AudioSource`. An audio source must be attached to the game object that is to make a sound so that it comes from the correct source. It cannot be part of a custom asset which is not a component.</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;Fortunately, the Unity framework has a solution to that problem. It is called `UnityEvent`.</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;```c#</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  [SerializeField] private AudioClips audioClips;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  [SerializeField] private UnityEvent audioClipsEvent;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;```</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;will display in the inspector as follows.</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;![Audio Clips CustomAsset](AudioClips1.png)</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;![Choose audio clip from a list](AudioClips2.png)</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;The reference to `AudioClips` is optional. It is only there so that we can change the fields in the editor without going to the asset.</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;If you are calling `Play` from code, then you can supply an `AudioSource` or a game object that has an audio source component.</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;```c#</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  [SerializeField] private AudioClips audioClips;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  void Play() { audioClips.Play(gameObject); }</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  void Play1() { audioClips.Play(GetComponent&lt;AudioSource&gt;(); }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;```</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;Using `AudioClips` wherever you have sound effects makes your game sound a lot more lively. You could also consider making similar assets for visual effects or animations.</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;### ChangeOverTime</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;It is always fun to factor out common manager custom assets into common code. Health, mana, stamina and similar look better if changes are not instantaneous. Moreover, some, like poison, have to happen over a period. Create managers without code using the `ChangeOverTime` custom asset.</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;![Change custom asset over time](Health-SmallPotion.png)</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;![Change custom asset over time](Health-PoisonArrow.png)</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;### Custom Asset Sets</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;`Set`, like `OfType` is a generic class. To instantiate it requires the type of set entries.</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;```c#</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;[CreateAssetMenu(menuName = &quot;Examples/SetPicker&quot;, fileName = &quot;SetPickerSample&quot;)]</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;public sealed class SetPickerSample : Set&lt;AudioClip&gt; {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  public void Play() { AudioSource.PlayClipAtPoint(clip: Pick(), position: Vector3.zero); }</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;}</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;```</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;This example can be used to play one of a selection of sounds. This is a great way to make a game sound less tedious.</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;#### Pick()</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;All classes inheriting from `Set` have a `Pick()` method with two controlling field entries:</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;* ***cycle***: True to return entries sequentially, false to get a random selection.</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;* ***exhaustiveBelow***: If the number of entries in the set is below this value, then while `Pick()` returns a random entry, no entry is retrieved twice before all the others have had a turn. From a list of three, nothing appears random.</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;These options are available in the editor when you create a custom asset from a `Set`.</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;#### Add(entry)</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;While in most cases the `Set` will be filled by the Unity Editor to save as an Asset, there are occasions where adding additional elements will be needed.</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;#### Remove(entry)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;On occasions, a `Set` entry will expire, and it will be necessary to remove them.</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;#### Contains(entry)</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;See if a `Set` contains a specific entry.</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;#### Count</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;Retrieve the number of entries in a set.</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;#### ForEach</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;Call an action for every entry in a set. If the action returns false, all is complete.</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;```c#</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;mySet.ForEach((s) =&gt; {return s!=&quot;Exit&quot;;});</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;```</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;#### StringSet</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;Strings as a set have many usages. `Quotes` is an implementation of `StringSet`.</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;## Editing Custom Assets</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;Serialised fields can be edited in the Unity Inspector just as you would a MonoBehaviour attached to a game object. Unlike a scriptable object, custom assets unload when play mode completes. In this way, they behave more like MonoBehaviours. There is a reason for this madness. In the Unity editor, scriptable objects remain loaded and only reload if the backing code or asset changes on disk. If we don&#39;t reset on leaving play mode, changed data from one run lives to the next.</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;## Custom Assets as Resources</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;If you can accept the tighter coupling, you can load custom assets my name. It is an alternative to dropping them into referring fields in the Unity inspector. The custom asset must reside in a directory under a ***Resources*** path - anywhere in the project.</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;```c#</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;// expects /anywhere-in-assets/Resources/Audio/cow-sounds.asset</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;var moos = Resources.Load&lt;AudioClips&gt;(&quot;Audio/cow-sounds&quot;);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;```</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;## Custom Assets as Event Sources</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;The first significant departure from ScriptableObject that CustomAsset provides is the ability to act as an event source.</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;Primitive custom assets (trigger, boolean, integer, float and string) are extremely easy to use. Drag a reference using the Unity editor into any MonoBehaviour or CustomEvent that needs to access or update them.</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;Drivers and Connectors (described below) also need a reference. They register for changing events. The event fires when and only when the custom asset changes.</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;### Polling</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;No matter how hard we try there is data that changes, and we cannot be informed promptly. The technique of last resort is called polling - where we check periodically for change. The inspector for any mutable custom asset includes some polling fields. Just enable polling in the inspector and set the intervals.</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;![Polling for changes](Polling.png)</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;## Using Custom Assets</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;Life begins now. Without writing any code, you can use the prepackaged custom assets and listeners to connect components without them knowing about each other.</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;Don&#39;t believe me? Create a game object inside a canvas and add a slider component.</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;***Step 1***: Create a Float custom asset from the Unity editor main or context menu.</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;![Menu to create a custom asset](Slider-6-Create-Custom-Asset.png)</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;***Step 2***: Select the custom asset and add any initial data.</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;![Inspector view of CustomAsset.Float](Float-CustomAsset-Editing.png)</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;***Step 3***: Create a new GameObject in the Unity Hierarchy window. Make sure it is inside a Canvas GameObject.</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;![Creating a slider](Slider-1-Hierarchy.png)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;***Step 4***: Go to the inspector for the game object *Slider* and add a slider component.</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;![UI Slider Component Inspector View](Slider-3-Component1.png)</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;***Step 5***: Add an *On Value Change* field and drag the Float custom asset into the associated field. Use the function drop-down to select ***Float: Value***.</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;![Setting a slider to update a custom asset](Slider-4-Component2.png)</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;***Step 6***: Lock the inspector on the Float custom asset and run the scene. Drag the slider and watch the value change in the inspector.</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;![How the slider looks on the unity application window](Slider-2-Screen.png)</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;For extra points, we can create a code-less health display bar.</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;***Step 7***: Create a UI Button GameObject in a Canvas and change the image type to *Filled*. Note that moving the *Fill Amount* slider causes the button to change background proportionately.</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;![Setting up an image to be filled driven by a Float custom asset](Slider-7-Image-to-Fill.png)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;***Step 8***: Press the *Add Component* Button then search for and add the *FloatDriver* component. Set the custom asset to the one created above and the component value setter to *Image.FillAmount*.</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;![Adding a CustomAsset.Float driver](Slider-8-Listener.png)</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;***Step 9***: Run the application and move the slider created above. The button fills and empties accordingly.</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;![How the fill looks for this sample at 0.75](Slider-9-Image-Filling.png)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;For components, like Animator, with named values Used *NamedFloatDriver* and it&#39;s siblings.</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;### Referencing CustomAsset Contents</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;Anywhere you want direct access to a custom asset, create a reference in your MonoBehaviour, CustomAsset or ScriptableObject and assign it in the inspector.</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;``` c#</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;class MyHealthComponent : MonoBehaviour {</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  [SerializedField] CustomAsset.Float health;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  private void OnEnable() =&gt; health.Value = 1.0F;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;```</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;You can also use the custom access emitter directly to react to change.</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;``` c#</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  private void HealthChanged() {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    UpdateHealthBar(health.Value);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    if (health.Value &lt;= 0) {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      Fibers.Start.Do(DieAnimation).WaitFor(seconds: 5).Do(ReturnToStartScreen);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    }</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  }</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  private void Start() =&gt; health.Emitter.Subscribe(HealthChanged);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;```</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;### Code-Free CustomAsset Usage</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;Even the minimalistic code above is unnecessary for many CustomAsset applications with the use of drivers and connectors.</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;#### Drivers</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;A driver is a MonoBehaviour that is designed to listen for custom asset changes and interact with other components of a game object directly. If you are passing information, the method must be in the ***Dynamic Data*** section.</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;Add them to the Inspector view by dragging them in or using the menu ***Component/CustomAssets/Name of Driver***.</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;![Sample CustomAsset.FloatDriver](Image-FillAmount-Driver.png)</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;Triggers are the exception and can use methods from ***Static Parameters***.</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;![Sample CustomAsset.TriggerDriver](Audio-Play-Driver.png)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;All primitive data drivers have a matching version that starts with Named. These are to drive components like ***Animator*** that require a parameter name as well as the value. Since ***Animator*** does not expose it&#39;s internals to the Inspector, we need to resort to a connector.</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;![Sample CustomAsset.NamedFloatDriver](Animator-Driver.png)</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;This package provides drivers for all primitive data type, but it is trivial to add new ones.</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;``` c#</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  public class MyBangDriver : ListenerComponent {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    public Float Asset =&gt; Listener.AssetToMonitor as Float;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    [Serializable] private class BangUnityEvent : UnityEvent&lt;Bang&gt; { }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    [SerializeField] private BangUnityEvent componentValueToSet = default;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    protected override void OnChange() =&gt;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      componentValueToSet.Invoke(Asset.Value);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    #if UNITY_EDITOR</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    [MenuItem(&quot;Component/CustomAssets/Bang Driver&quot;)]</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    private static void AddConnector() =&gt; Selection.activeTransform.gameObject.AddComponent&lt;MyBangDriver&gt;();</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    #endif</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;```</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;Of course, you are unlikely to find a Unity component that knows what to do with a ***Bang*** object. You would be writing your own or relying on a Connect component (as described below) to distribute a ***Bang*** to the rest of the game object.</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;#### Connectors</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;If a component does not expose the data in the Unity inspector, then it is necessary to use a connector. The animator connector used above provides an excellent example.</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;Add them to the Inspector view by dragging them in or using the menu ***Component/CustomAssets/Name of Connector***.</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;``` c#</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  public class AnimatorCustomAssetConnector : MonoBehaviour {</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    public void SetTrigger(string parameterName) =&gt; animator.SetTrigger(parameterName);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    public void SetInteger(string parameterName, int value) =&gt; animator.SetInteger(parameterName, value);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    public void SetFloat(string parameterName, float value) =&gt; animator.SetFloat(parameterName, value);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    public void SetBoolean(string parameterName, bool value) =&gt; animator.SetBool(parameterName, value);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    private Animator animator;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    private void Awake() =&gt; animator = GetComponent&lt;Animator&gt;();</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    #if UNITY_EDITOR</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    [MenuItem(&quot;Component/CustomAssets/Animator Connector&quot;)]</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    private static void AddConnector() =&gt; Selection.activeTransform.gameObject.AddComponent&lt;AnimatorCustomAssetConnector&gt;();</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    #endif</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;```</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;Most connectors only require the information without a parameter name.</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;``` c#</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  public class TransformCustomAssetConnector : MonoBehaviour {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    public void ScaleX(float value) =&gt;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      transform.localScale = new Vector3(value, transform.localScale.y, transform.localScale.z);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    // ...</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;```</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;### Concrete Component Connectors</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;The components listed here are part of a growing list of listeners that can be used to minimise coupling and reduce project specific code.</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;#### Animator Connector</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;An animator component relies on an outside source to set a named trigger, integer, float or bool variable. ***AnimatorCustomAssetConnector*** exposes all if them. When hooked up to a custom asset you can change the value where the logic is appropriate and the matching animation plays.</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;#### RectTransform Connector</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;***RectTransformCustomAssetConnector*** inherits from ***TransformCustomAssetConnector*** and adds the concepts of anchors, width, height, left, right, top, bottom as is appropriate for UI transforms.</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;#### TransformConnector</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;This connector allows for changes to the scale, rotation and position for any gameObject.transform. There is a video linked at the start of this document that uses changes of scale to show/hide a health-bar.</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;#### GameObjectConnector</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;The `GameObjectConnector` is a bit different. Add it to an existing GameObject with the menu ***Component/Custom Assets/GameObject Connector**** then drop in a custom asset that inherits from CustomAssets.Mutable.GameObject. Now code anywhere can access the game object.</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;## Custom Asset Persistence</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;If a custom asset is marked persistent in the Inspector, then it writes itself out to the PlayerPref database using a key combining the name and class.</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;Persistence occurs when the asset&#39;s `OnDisable` method is called - typically when the operating system has decided to throw the game out of memory.</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;For primitive assets, any updates happen without further coding.</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;```c#</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  Float age;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  age.Value = 32.2f;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;```</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;For custom assets containing a more complicated class or struct, the creator is responsible for marking changes either directly with `Changed()` or as part of the update. For the latter, creating accessors in the custom asset provided for clearer calling code that using Value directly - while calling `Set` on the update informs all listeners.</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;```c#</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;[CreateAssetMenu(menuName = &quot;Examples/LargerAssetSample&quot;)]</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;public class LargerAssetSample : CustomAsset.OfType&lt;CustomAssetsExample.LargerAssetContents&gt; {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  public int AnInteger { get { return Value.I; } set { Set(() =&gt; Value.I = value); } }</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  public float AFloat { get { return Value.F; } set { Set(() =&gt; Value.F = value); } }</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  public string AString { get { return Value.S; } set { Set(() =&gt; Value.S = value); } }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;}</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;```</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;### Quotes</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;`Quotes` is a `StringSet` Custom Asset that if given a list of lines and a `TextAsset` returns a line using the `Pick` interface. A quote is formatted as a ***body of the quote (attribution)*** where the attribution is optional. The attribution is surrounded in brackets and must be at the end of the line. RTF is acceptable in the quote.</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;I would recommend setting ***Exhaustive Below*** to a figure like 50 or 100. Otherwise shorter lists appear to repeat entries too often.</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;#### RTF</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;RTF is a static function to convert a string quote into RTF format so that the attribution can be in grey. The text between brackets at the end of the line makes up the attribution.</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;```c#</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;Debug.Log(Quotes.RTF(&quot;Life wasn&#39;t meant to be easy (George Bernard Shaw)&quot;));</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;```</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;produces</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;***&quot;***Life wasn&#39;t meant to be easy***&quot;***     *George Bernard Shaw*</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;## Examples</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;### Health Bar</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;* First, create a test scene (menu Assets/Create/Scene)</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;* Create a CustomAsset to store the health (menu Assets/Create/Custom Assets/Mutable/Float)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;![Float custom asset to represent player health](Health-CustomAsset.png)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;* Create a canvas (menu GameObject/UI/Canvas)</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;* Create an empty child GameObject and call it ***HealthBar***</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  * Set it to a reasonable size</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;![Inspector view of HealthBar game object transform](HealthBar.png)</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;* Create an image child (menu GameObject/UI/Image) and call it ***Background***</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  * Set colour to red</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  * Set position and size to 0</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  * Set X and Y anchors to Min 0, Max 1</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  * Change X pivot to 0</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;![Inspector view of health-bar background](Health-Background.png)</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;* Duplicate the Background, rename Foreground and change to green</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;* The foreground is the only active component. We are going to reduce the scale so that the background shows through. Since transforms don&#39;t expose their data, we use a connector. (Drag connector into Inspector)</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;*  And we need a float driver to change the scale when our health custom asset changes (drag Float-Driver into the inspector)</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;* This is where we hook them up (drop health asset into the driver and set the component to ScaleX)</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;![Inspector view of health-bar foreground](Health-Foreground.png)</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;* We created the health scene for two reasons - so that we can tweak our health bar before adding it to our project and so we can add manual and automatic testing. We need to add a component to drive the health bar. Fortunately, the Unity UI has a slider that works a treat. (Bounds//context//UI//Slider)</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;![Inspector view of health-bar test slider](Health-Slider.png)</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;* It is as simple as pie to hook in our custom asset (On Value Change/+/Health custom asset/Float.Value)</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;* Run the scene and drag the slider to make the health bar change</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;![Running demo of health-bar](Health-Demo.png)</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;### Health Bar Integrity Testing</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;The integrity test loads our sample scene and exercises the slider to make sure that the health bar behaved accordingly.</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;``` c#</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  public class HealthBarTranscript : PlayModeTests {</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    private static string scenePath = &quot;Health&quot;;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    //- PlayModeTests provides a support function to make sure</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    //- the scene is in the Build Settings so it can be run</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    #if UNITY_EDITOR</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    [InitializeOnLoadMethod]</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    private static void AddSceneToBuildSettings() =&gt; AddSceneToBuildSettings(scenePath);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    #endif</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    //- We will only need a single method to test the integrity</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    //- of the health-bar functionality.</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    [UnityTest] public IEnumerator HeathBarTests() {</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      yield return LoadScene(scenePath);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      //- We will need a reference to the slider for control</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      //- and the foreground to check the results</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      var slider     = Component&lt;Slider&gt;(&quot;Testing Slider&quot;);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      var foreground = Component&lt;RectTransform&gt;(&quot;Foreground&quot;);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      //- Set the slider to match the health starting value</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      slider.value = foreground.localScale.x;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      //- local function to set and check a health value.</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      //- Note the wait. It could be one frame, but I have made it longer</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      //- so we can see the test happening.</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      IEnumerator setAndCheck(float health) {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        slider.value = health;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        yield return new WaitForSeconds(0.1f);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        var scale = foreground.localScale.x;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        Assert.AreApproximatelyEqual(health, scale);</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      //- Check bounds</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      yield return setAndCheck(0);</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      yield return setAndCheck(1);</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      //- Ramp up and make sure all matches</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      for (float health = 0; health &lt;= 1; health += 0.05f) yield return setAndCheck(health);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      //- Now let&#39;s do some random ones</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      //- in case change of direction can be a problem.</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      for (int i = 0; i &lt; 20; i++) {</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        yield return setAndCheck(Random.Range(0f, 1f));</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    }</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  }</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;```</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;### Health Manager</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;In this context, a manager is logic (code) with a single concern (a data item). If that concern is not directly visual or player interactive then it is best served with a custom asset. By limiting I/O to some extremely simple and stupid MonoBehaviours, we can test almost all of the game components in isolation or groups as needed.</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;To allow adequate testing of custom asset managers, they should not be coupled with each other or the Unity framework. We accomplish everything with custom assets and observers.</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;Following the single responsibility principle, each manager should be small and focused. In this case, the health manager manages the permanent improvements to health over time.</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;* A manager needs the code because it holds game logic</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;``` c#</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  //- Custom assets must be created to physical files in the project.</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  //- We could have more than one.</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  [CreateAssetMenu(menuName = &quot;Managers/Health&quot;), Serializable]</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  public class HealthManagerTranscript : Manager {</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    //- The field we are managing</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    [SerializeField] private Float health = default;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    //- Health will slowly increase over time.</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    //- A permanent game ability could change this value</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    [SerializeField] private Float trickleChargePerSecond = default;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    protected override void Initialise() {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      base.Initialise();</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      //- We can just update health every second.</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      //- Float corrects for health over the maximum</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      void trickleCharge(Fiber fiber) =&gt;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        health.Value += trickleChargePerSecond;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      //- Fibers are efficient, only waking once a second to update health value</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      Fiber.Start.Begin.WaitFor(seconds: 1.0f).Do(trickleCharge).Again.Finish();</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    }</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  }</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;```</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;* Create a new ***Float*** custom asset and call it ***TrickleChargePerSecond***.</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;![](Health-TrickleChargePerSecond.png)</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;* Create a health manager with the menu or context menu ***Assets // Create // Manager // Health***. Fill custom asset references with ***Health*** and ***TrickleChargePerSecond*** custom asset references.</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;![A health manager ready for deployment](Health-Manager.png)</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;* Decoupled Managers need to tell our game that they exist. Create a game object from the ***GameObject/Create Managers*** menu and drag a reference to your manager into it. It only needs to be done in your opening scene.</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;![Inspector view of health manager](Health-Managers-GameObject.png)</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;* All other health changes can be made using `CustomAsset.ChangeOverTime` instances.</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;![Effects of small healing potion](Health-SmallPotion.png)</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;![Effects of being hit by a poison arrow](Health-PoisonArrow.png)</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;#### Health Manager Integrity Testing</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;Managers do not need a scene to run, but they do need one for Fibers. They use ```UnityTest``` but do nothing visual. We could take this further by making sure that the increase in health matches the trickle charge per second value.</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;``` c#</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;//- While Fibers do not need to run from a MonoBehaviour,</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;//- they still need a running scene - so we use UnityTest</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;public class HealthManagerTest : PlayModeTests {</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;//- The Timeout attribute uses Time.timeScale.</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;[UnityTest, Timeout(100000)] public IEnumerator HealthManager() {</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  //- Our health component will take 1,000 seconds</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  //- to go from zero to full. Let&#39;s speed things up by 10x</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  Time.timeScale = 10;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  try {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    //- We don&#39;t need a specific scene, just load the custom assets</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    Manager.Load&lt;HealthManagerTranscript&gt;(&quot;HealthManager.asset&quot;);</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    var health = Manager.Load&lt;Float&gt;(&quot;Health.asset&quot;);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    //- Set to 0 since once a custom asset is loaded in the editor </div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    //- it stays loaded</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    health.Set(0);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    //- It looks like forever, but the Timeout attribute</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    //- will cause a test failure after 10 seconds</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    while (true) {</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      //- This causes a 1/10th of a second delay due to the modified scale</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      yield return new WaitForSeconds(1.0f);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      //- Leaving once the test passes is a successful result.</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      //- This should take 1 second at the current time scale.</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      if (health &gt;= 0.01f) yield break;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    }</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  } finally {</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    //- reset the time scale for other tests.</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    Time.timeScale = 1;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  }</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;}</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;```</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;### Refactoring to use Custom Assets</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;Below is a typical game manager MonoBehaviour for a 2D game. Usually, I wouldn&#39;t refactor a working system. Whenever I need to fix a bug, add a feature or make a performance improvement, I  refactor the relevant code.</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;For example, if I needed to update `KillPlayer` I would factor it out into a death manager and leave everything else as-is. If I were a good boy (and I am), I would write an integration test to go with it. The actual work would be minimal, and the stability gains for future changes makes it all worth-while.</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;#### The Original Code</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;``` c#</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;public sealed class GameManager : MonoBehaviour {</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  public static GameManager Instance { get; private set; }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  public int Lives { get; private set; }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  public event Action&lt;int&gt; OnLivesChanged;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  public event Action&lt;int&gt; OnCoinsChanged;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  private int coins;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  private int currentLevelIndex;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  private void Awake() {</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    if (Instance != null) {</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      Destroy(obj: gameObject);</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    } else {</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      Instance = this;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      DontDestroyOnLoad(target: gameObject);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      RestartGame();</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    }</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  }</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  public void KillPlayer() {</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    Lives--;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    if (OnLivesChanged != null) OnLivesChanged(Lives);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    if (Lives &lt;= 0) {</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      RestartGame();</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    } else {</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      SendPlayerToCheckpoint();</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    }</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  }</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  private void SendPlayerToCheckpoint() {</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    var checkpointManager = FindObjectOfType&lt;CheckpointManager&gt;();</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    var checkpoint        = checkpointManager.GetCheckpointThatWasLastPassed();</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    var player            = FindObjectOfType&lt;PlayerMovementController&gt;();</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    player.transform.position = checkpoint.transform.position;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  }</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  public void MoveToNextLevel() {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    currentLevelIndex += 1;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    SceneManager.LoadScene(currentLevelIndex);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  }</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  private void RestartGame() {</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    currentLevelIndex = 0;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    Lives             = 3;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    coins             = 0;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    if (OnCoinsChanged != null) OnCoinsChanged(coins);</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    SceneManager.LoadScene(sceneBuildIndex: 0);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  public void AddCoin() {</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    coins++;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    if (OnCoinsChanged != null) OnCoinsChanged(coins);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  }</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;}</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;```</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;#### Change Summary</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;* `Instance` and `Awake` are removed as not necessary since once we refactor all the code</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;* `Lives`, `coins` and `currentLevelIndex` becomes a `CustomAsset.Integer`</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;* `OnLivesChanged` is provided by the custom asset `Lives` - no code required</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;* `OnCoinsChanged` is provided by the custom asset `Coins` - no code required</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;* `KillPlayer` is absorbed into the manager custom asset `PlayerDeathManager`</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;* `SendPlayerToCheckpoint` is absorbed into the manager custom asset `PlayerDeathManager`</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;* `MoveToNextLevel` becomes `scene.Value += 1`</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;* `RestartGame` could become a `CustomAsset.Trigger` called `RestartManager`</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;* `AddCoin` disappears and logic accesses the `Coins` custom asset directly.</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;#### PlayerDeathManager</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;``` c#</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  [CreateAssetMenu(menuName = &quot;Managers/Player Death&quot;), Serializable]</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  public class PlayerDeathManager : Manager {</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    [SerializeField] private Float      health       = default;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    [SerializeField] private Integer    coins        = default;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    [SerializeField] private Integer    lives        = default;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    [SerializeField] private Integer    maximumLives = default;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    [SerializeField] private Integer    scene        = default;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    [SerializeField] private GameObject player       = default;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    [SerializeField] private GameObject checkpoint   = default;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    protected override void Initialise() =&gt; health.Emitter.Subscribe(OnHealthChange);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    private void OnHealthChange() {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      if (health &lt;= 0) KillPlayer();</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    }</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    private void KillPlayer() {</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      if (lives &lt;= 1) {</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        RestartGame();</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      } else {</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        SendPlayerToCheckpoint();</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      }</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    }</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    private void RestartGame() {</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      scene.Value = 0;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      lives.Value = maximumLives;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      coins.Value = 1;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    }</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    private void SendPlayerToCheckpoint() =&gt; player.Value.transform.position = checkpoint.Value.transform.position;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  }</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;```</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;#### SceneManager</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;``` c#</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  [CreateAssetMenu(menuName = &quot;Managers/Scene&quot;), Serializable]</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  public class SceneManager : Manager {</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    [SerializeField] private Integer scene = default;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    protected override void Initialise() =&gt; scene.Emitter.Subscribe(OnSceneChange);</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    private void OnSceneChange() =&gt; UnityEngine.SceneManagement.SceneManager.LoadScene(sceneBuildIndex: scene);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  }</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;```</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>Askowl-CustomAssets.md</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
