<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Decoupler: Askowl-Decoupler.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Askowl-100x100.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Decoupler
   </div>
   <div id="projectbrief">Askowl Service Decoupler</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_askowl-_decoupler_8md.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Askowl-Decoupler.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;---</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;title: Askowl Decoupler for Unity3D</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;---</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;* Table of Contents</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;{:toc}</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&gt; The Doxygen pages are [here](https://paulmarrington.github.io/Unity-Documentation/Decoupler/Doxygen/html/annotated.html)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;# [Executive Summary](http://www.askowl.net/unity-decoupler)</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;The Askowl Decoupler is here to provide an interface between your code and Unity packages. Take analytics packages as an example. There are dozens of them. With Askowl Decoupler you can switch between them depending on which you have installed. You can also choose at platform build time. Not all analytics packages support XBox or Web apps. The same logic works for databases, social networks, authentication and many others.</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&gt; Read the code in the Examples Folder.</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;# Introduction</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;Decoupling software components and systems have been a focus for many decades. In the 80s we talked about software black boxes. You didn&#39;t care what was inside, just on the inputs and outputs.</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;Microsoft had much fun in the 90&#39;s designing and implementing COM and DCOM. I still think of this as the high point in design for supporting decoupled interfaces.</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;Now we have Web APIs, REST or SOAP interfaces and microservices. Design patterns such as the Factory Pattern are here to &quot;force&quot; decoupling at the enterprise software level. There have been dozens of standards over the years.</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;Despite this, programmers have continued to create tightly coupled systems even while enforcing the requirements of the framework.</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;Consider a simple example. I have an app that uses a Google Maps API to translate coordinates into a description &quot;Five miles south-west of Gundagai&quot;. My app is running on an iPhone calling into a cloud of Google servers. The hardware is different and remote, and they both use completely different software systems. However, my app won&#39;t run, or at least perform correctly, without Google. Worse still if I am using a Google library, it won&#39;t even compile without a copy.</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;# What is the Askowl Decoupler</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;First and foremost, the Askowl Decoupler is a way to decouple your app from packages in the Unity3D ecosystem.</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;It works at the C# class level, meaning that it does not provide the physical separation. That is provided by the Unity packages when needed. In approach, it acts very much like a C# Interface.</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;# What does the Askowl Decoupler give me?</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;1. You can build and test your app while waiting for supporting Unity packages to be complete.</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;2. You can choose between unity packages without changing your app code. Changing from Google Analytics to Unity Analytics to Fabric is as simple as getting or writing the connector code.</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;3. You can provide a standard interface to a related area. For social media, the interface could support FaceBook, Twitter, Youtube and others. You could then send a command to one, some or all of them. Think of this regarding posting to multiple platforms.</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;4. You can have more than one service then cycle through them or select one at random. For advertising, you can move to a new platform if the current one cannot serve you an ad.</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;# Decoupling Packages</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;## How do I use a decoupled package?</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;Always get an instance through static methods on the interface.</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;### For singleton services</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;Access the registered service using the Instance selector. If keeping a reference, set it in Awake or later. It gives the services an opportunity to register.</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;```c#</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;Decoupled.Authentication auth;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;void Awake() { auth = Decoupled.Authentication.Instance; }</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;```</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;### To cycle through a list of services</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;Access the next registered service using the Instance selector.</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;```c#</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        Adze.Server server = Adze.Server.Instance;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        int cycleIndex = server.CycleIndex;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        do {</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;          yield return server.Show(currentMode);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;          if  (server.error) break;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;          server = Adze.Server.Instance;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        } while (server.CycleIndex != cycleIndex);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;```</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;In the example, the code will cycle through all the advertising services, stopping when one display an ad or when the list has been exhausted.</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;### To select a named service</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;All services have a name. Names are set by either specifying the name in `Register`/`Load` or using the default name is the class name of the service. A service can then be retrieved by name using `Named`.</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;```c#</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;[RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.BeforeSceneLoad)]</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    private static void RegisterService() { Social.Register &lt;Facebook&gt;(); }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;```</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;```c#</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  Decoupled.Social facebook = Decoupled.Social.Named(&quot;Facebook&quot;);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;```</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;### Send to All Services</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;Another type of service is to have multiple instances, and we need to do something with all of them. It could be anything from display a list of names for user selection or call a method on some or all of them. `Social` is one of these where we may be connected to multiple social networks and send a message to some.</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;```c#</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;for (int i = 0; i &lt; Decoupled.Service.InstanceList.Count; i++) {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  Decoupled.Service.InstanceList[i].Send(myMessage);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;}</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;```</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;### To choose a service randomly</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;`Random()` and `Exhaustive()` are static methods on the interface. Random selection can cause a perceived imbalance with short lists. Exhaustive is also a random picker, but it ensures all choices are exhausted before starting again.</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;```c#</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  Decoupled.Social.Random();</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  Decoupled.Social.Exhaustive();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;```</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;### How do I know if there is a service implemented</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;All service interfaces have a static member `Available`.</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;```c#</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  if (!Decoupled.Social.Available) Debug.Log(&quot;Oops&quot;);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;```</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;## How much work do I need to do to implement a decoupler?</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;### For an already written decoupled package</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;#### If it comes with a controller or *prefab*</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;1. Create an empty gameObject in the first scene of your game</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;2. Drag the controller code or *prefab* to the gameObject</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;3. Fill any requirements in the controller from the Unity editor</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;4. Run the app. The decoupled package replaces the default placeholder</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;#### If it has an initialiser in an Editor directory</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;There is nothing more to do.</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;In either case, if external dependencies are needed, the log provides what is needed.</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;### For a new package and an existing interface</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;1. Create a new project</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;2. Import any unity packages required</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;4. Create an API where the base class is the interface</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;5. Implement the virtual methods as needed (using override)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;6. Create a loader method to register this service</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;A sample service would look something like this.</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;```c#</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;#if AnalyticsFabric</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  public sealed class AnalyticsFabric: Analytics {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    public override void Event(string name){/* etc etc */}</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    [RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.BeforeSceneLoad)]</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    private static void RegisterService() { Analytics.Register&lt;AnalyticsFabric&gt;(); }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;#endif</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;```</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;By using ***Askowl.DefineBuild** set a definition file in an ***Editor*** directory. Here we are deciding on the existence of a package by the existence or not of a directory.</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;```c#</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  [InitializeOnLoad]</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  public sealed class DetectMyUnityPackage : DefineSymbols {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    static DetectMyUnityPackage() {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      bool usable = HasFolder(&quot;Fabric&quot;);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      AddOrRemoveDefines(addDefines: usable, named: &quot;AnalyticsFabric&quot;);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;}</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;```</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;### For a new interface</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;The decoupler interface is not an Interface in the Java/C# sense. It is a base class. It provides decoupling support as well as default functionality.</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;If the decoupler interface is for a new package you are writing, then the methods are a matter for software design. If it is an existing package, then the contents reflect the functionality you want to access. It can be just the parts you need or if for distribution, it may be exhaustive. For an example of the latter, look at ***Askowl-Decoupler/Services/Analytics***. There are multiple classes here to represent different aspects of the analytics requirement.</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;```c#</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;namespace Decoupled.Analytics {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  public class Play : Decoupled.Service&lt;Play&gt; {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    public virtual void Screen(string name, string clazz) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      Debug.Log(&quot;**** Screen &#39;&quot; + name + &quot;&#39; - &quot; + clazz);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  // ...more</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;}</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;```</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;Most interface methods do nothing. Since analytics is a form of logging, it is best to display to the console by default. In our production code, we may override the interface with Firebase Analytics for Android and iOS, but falling back to the default for the Editor. We might even choose a different analytics system for OS X, Windows or Windows Phone.</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;Often when the interface is for remote services, results are asynchronous.</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;```c#</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;namespace Decoupled {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  public class Authentication: Decoupled.Service&lt;Authentication&gt; {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    public class User {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      public string Name = &quot;guest&quot;;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      public string Email = &quot;&quot;;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      public string PhotoUrl = &quot;&quot;;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      public string PhoneNumber = &quot;&quot;;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      public string ProviderId = &quot;&quot;;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      public string UserId = &quot;&quot;;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      public bool IsVerified = false;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      public bool IsLoggedIn = false;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      public object MetaData = null;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    public User user = new User ();</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    public virtual IEnumerator CreateUser(string email, string password, Action&lt;string&gt; error = null) {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      user.Name = user.Email = email;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      yield return null;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  // ... more</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;```</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;In a service that talks to a server, the yield waits for a response. This example also shows an inner data class. Each application has to fill it from server supplied data.</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;It may seem like much work, but it is quite simple. Writing an interface is a matter of learning what is available and deciding what is required.</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;## Mocking</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;Another advantage of decoupling interfaces is the ability to add mocked services. Often services are unavailable or have restrictions on pre-production use. As an example, I mock the GPS service so that I can test in the Unity editor. I also mock authorisation, authentication and social media services.</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;Also, partial mocking has value. I can subclass a database driver to make sure that they use test tables or documents.</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;If a service implementation calls `RegisterAsMock` instead of `Register`, then this service locks itself in as the provider. Decoupler provides a generic `Mock` MonoBehaviour that allows you to turn mocking on and off from the inspector. It registeres the service in `Awake()`. There is a template in Decoupler/Mock.</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;``` c#</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  public class MockTemplate : Mock&lt;MockTemplate.Service&gt; {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    // Data that can be changed in the inspector to effect mock results</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    [SerializeField] private string templateData;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    public class Service : TemplateService { =</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      /* mock implementations of service methods */</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  }</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  public class TemplateService : Service&lt;TemplateService&gt; {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    /* abstract or default service methods */</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;```</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;There is always a risk of mocks leaking to production. Decoupler mocks write a warning to the log, so as long as you insist on a clean log before release, all is well.</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;## Built-In Interfaces</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;To use a decoupled service, you need to have an interface class. Often these are provided with packages that need them, but for commonly needed ones, we have included them in Askowl Decoupler.</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;* [Analytics](http://analytics.marrington.net)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;* [Authentication](http://authentication.marrington.net)</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;* [Database](http://database.marrington.net)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;* [DynamicLinks](http://dynamicLinks.marrington.net)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;* [Invites](http://invites.marrington.net)</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;* [Messaging](http://messaging.marrington.net)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;* [RemoteConfig](http://remoteConfig.marrington.net)</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;* [Social](http://social.marrington.net)</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;* [Storage](http://storage.marrington.net)</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;# Decoupling Components</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;Decoupling means providing a familiar code interface to components of similar functionality. Two examples that come to mind are UI Text components and Cameras.</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;## How do I use decoupled components?</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;Drag the decoupled component into the inspector for your game object. The decoupler is bright enough to work out and load the component it needs. When you have a choice, load a component first, and the decoupler uses it. If the decoupler already exists, select *Reset* to have it pick up and changes.</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;&lt;img src=&quot;Textual.png&quot; width=&quot;50%&quot;&gt;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;In this example, the *TextMesh Pro* package exists. The decoupler recognises it and adds the correct component when ***Textual*** is loaded or reset. If I wanted to use the built-in UI Text component instead, I could have added it first or removed the TextMesh Pro and added the UI Text component. ***Textual*** won&#39;t override your choice.</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;To change the text content, use the Textual component decouples your code from the underlying implementation.</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;```c#</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;Textual messages;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;void OnEnable() { messages = GetComponent&lt;Textual&gt;(); }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;void ChangeMessage(string newMsg) { messages.text = newMsg; }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;```</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;## Creating Decoupled Components</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;Given a choice between two systems, you need to create four classes - one for the interface, one for each of the systems and one to tell the editor which to load.</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;The class to create a compiler definition needs to be in an Editor folder. With this set we can compile without errors since any code since any code requiring an optional package can be commented out with `#define`.</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;```c#</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  [InitializeOnLoad]</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  public class TextMeshProDefinition : DefineSymbols {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    static TextMeshProDefinition() {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      bool loaded = HasFolder(&quot;TextMesh Pro&quot;) || HasPackage(&quot;com.unity.textmeshpro&quot;);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      AddOrRemoveDefines(addDefines: loaded, named: &quot;TextMeshPro&quot;);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;```</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;Now we can create the interface as a partial class.</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;```c#</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  internal interface TextualInterface {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    string text { get; set; }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  public partial class Textual : ComponentDecoupler&lt;Textual&gt;, TextualInterface {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    private TextualInterface Backer =&gt; Instance as TextualInterface;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    public string text { get =&gt; Backer.text; set =&gt; Backer.text = value; }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;```</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;Let&#39;s deconstruct this.</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;* First we create an interface for all the properties and methods we want to expose.</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;* Next we add a class with a basic or mocked implementation of the interface.</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;* In this class we add a property, `Backer`,  for retrieving an instance of the interface from the underlying generic data reference.</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;* Lastly we need to place all the properties and methods onto the outer class for seamless use. The interface enforces this.</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;The second class is the default component. It should either be a stub or a native component that comes with Unity.</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;```c#</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  public partial class Textual {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    private class UnityTextInterface : ComponentInterface, TextualInterface {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      private Text UnityText =&gt; Component as Text;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      public string text { get =&gt; UnityText.text; set =&gt; UnityText.text = value; }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      public UnityTextInterface() =&gt; Instantiate&lt;Text&gt;(primary: false);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    private UnityTextInterface unityTextInterface = new UnityTextInterface();</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;```</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;We could have placed this in the first partial, but it is cleaner separated. Now we can replicate this for another component.</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;```c#</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    private class TextMeshProUguiInterface : ComponentInterface, TextualInterface {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      private TextMeshProUGUI TmpText =&gt; Component as TextMeshProUGUI;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      public string text { get =&gt; TmpText.text; set =&gt; TmpText.text = value; }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      public TextMeshProUguiInterface() =&gt;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;          Instantiate&lt;TextMeshProUGUI&gt;(primary: true);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;#if UNITY_EDITOR</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    [InitializeOnLoadMethod]</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;#endif</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    [RuntimeInitializeOnLoadMethod]</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    private static void TextMeshProUguiInitialise() {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      Instantiate&lt;TextMeshProUguiInterface, TextMeshProUGUI&gt;(primary: true);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;```</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;This time the code only exists if we have defined the variable ***TextMeshPro***. Since we know we want to use this component if it is available, we use the primary parameter. When you drop ***Textual*** into your game object you also get a TextMeshProGUI component.</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;What happens when you don&#39;t have TextMesh Pro installed? When you attach a ***Textual*** component, it won&#39;t find a compatible concrete component, so it uses what it can file - `Text`.</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;## Built-In Interfaces</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;### Place-holders</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;I will document the interfaces once an implementation is released.</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;1. ***Authentication*** - with Facebook, Google, etc</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;2. ***Database*** - cloud-based service</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;3. ***DynamicLinks*** - Cloud hyperlinking</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;4. ***Invites*** - Invite others to your team/game</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;5. ***Messaging*** - send and receive messages</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;6. ***RemoteConfig*** - update configuration without a reinstall</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;7. ***Social*** - for Facebook, Twitter, Google+, etc</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;### Textual</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;Add the component `Textual` to the inspector for your game object. It loads the Unity Text object unless you have installed the TextMesh Pro package.</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;```c#</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;Textual helpText;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;void OnEnable() { helpText = GetComponent&lt;Textual&gt;(); }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;void ShowHelp(string txt) { helpText.text = txt; }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;```</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>Askowl-Decoupler.md</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
